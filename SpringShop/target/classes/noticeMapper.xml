<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.shop.notice.NoticeMapper">

<!-- 글 입력 -->
	<insert id="uploadNotice" parameterType="com.spring.shop.notice.Notice">
		insert into notice_info (
			ni_no,
			ni_title,
			ni_content,
			ni_writer 
		)values(
			nextval('seq_ni_no'),
			#{ni_title},
			#{ni_content},
			#{ni_writer}	
		)
	</insert>

<!-- 글 list 출력 -->
	<select id="allNotice" resultType="com.spring.shop.notice.Notice" parameterType="map">
		select
			ni_no,
			ni_title,
			TO_CHAR(TO_TIMESTAMP(ni_instate , 'YYYYMMDDHH24MISS'), 'YYYY/MM/DD HH24:MI') "ni_instate",
			ni_writer 
		from notice_info order by ni_no desc
		limit #{E_OFFSET} - #{S_OFFSET} offset #{S_OFFSET}
	</select>

<!-- 총 글 수 -->
	<select id="totalCnt" resultType="int">
		select count(*)
		from notice_info
	</select>

<!-- 글 출력 -->
	<select id="printNotice" resultType="com.spring.shop.notice.Notice" parameterType="com.spring.shop.notice.Notice">
		select
			ni_no,
			ni_title,
			ni_content,
			TO_CHAR(TO_TIMESTAMP(ni_instate , 'YYYYMMDDHH24MISS'), 'YYYY/MM/DD HH24:MI') "ni_instate",
			ni_writer,
			file_name,
			saved_file_name
		from 
			notice_info ni
		inner join
			board_attach ba
		on
			(ba.board_id = ni.ni_no) 
		where 
			ni_no = #{ni_no}
		
	</select>

<!-- 파일 업로드 -->
	<insert id="addFile" parameterType="map">
		<selectKey keyProperty="ni_no" resultType="int" order="BEFORE">
			select max(ni_no)+1 from notice_info
		</selectKey>
		insert into board_attach (
		 	board_type,
			board_id,
			file_num,
			file_name,
			saved_file_name,
			file_size
		)values(
			'Notice',
			#{ni_no},
			nextval('seq_file_num'),
			#{name},
			#{fileSavedName},
			#{fileSize}
		)
	</insert>

<!-- 글 수정 -->
	<update id="updateNotice" parameterType="com.spring.shop.notice.Notice">
		update notice_info
		set
			ni_title = #{ni_title},
			ni_content = #{ni_content}
		where 
			ni_no = #{ni_no}
	</update>

<!-- 글 삭제 -->
	<delete id="deleteNotice" parameterType="com.spring.shop.notice.Notice">
		delete from notice_info where ni_no = #{ni_no}
	</delete>
	
<!-- 파일 삭제 -->
	<delete id="deleteFile" parameterType="String">
		delete from board_attach where saved_file_name = #{fileSavedName}
	</delete>

</mapper>